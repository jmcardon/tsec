<html><head><title>TSec: Motivation</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Jose Cardona" /><meta name="description" content="A Type-Safe General Cryptography Library on the JVM" /><meta name="og:image" content="/tsec/img/poster.png" /><meta name="og:title" content="TSec: Motivation" /><meta name="og:site_name" content="TSec" /><meta name="og:url" content="https://jmcardon.github.io/tsec/" /><meta name="og:type" content="website" /><meta name="og:description" content="A Type-Safe General Cryptography Library on the JVM" /><link rel="icon" type="image/png" href="/tsec/img/favicon.png" /><meta name="twitter:title" content="TSec: Motivation" /><meta name="twitter:image" content="https://jmcardon.github.io/tsec/img/poster.png" /><meta name="twitter:description" content="A Type-Safe General Cryptography Library on the JVM" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/tsec/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/tsec/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/tsec/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/tsec/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/tsec/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/tsec/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/tsec/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/tsec/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/tsec/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/tsec/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/tsec/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/tsec/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/tsec/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/tsec/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/tsec/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/tsec/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/tsec/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/tsec/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/tsec/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/tsec/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/tsec/highlight/styles/default.css" /><link rel="stylesheet" href="/tsec/css/style.css" /><link rel="stylesheet" href="/tsec/css/palette.css" /><link rel="stylesheet" href="/tsec/css/codemirror.css" /></head><body><header id="site-header"><div class="navbar-wrapper"><div class="container"><div class="row"><div class="col-xs-6"><a href="/tsec/" class="brand"><div class="icon-wrapper"><span>TSec</span></div></a></div><div class="col-xs-6"><nav class="text-right"><ul class=""><li><a href="https://github.com/jmcardon/tsec"><i class="fa fa-github"></i><span class="hidden-xs">GitHub</span></a></li><li><a href="/tsec/docs/symmetric.html"><i class="fa fa-file-text"></i><span class="hidden-xs">Documentation</span></a></li></ul></nav></div></div></div></div><div class="jumbotron"><div class="container"><h1 class="text-center">A Type-Safe General Cryptography Library on the JVM</h1><h2></h2><p class="text-center"><a href="https://github.com/jmcardon/tsec" class="btn btn-outline-inverse">View on GitHub</a></p></div></div><div><ul class="horizontalNav">                                   <li><a class="" href="/tsec/home.html">Home</a></li>  <li><a class="" href="/tsec/documentation.html">Documentation</a></li>  <li><a class=" active " href="/tsec/motivation.html">Motivation</a></li>  <li><a class="" href="/tsec/philosophy.html">Philosophy</a></li> </ul></div></header><main id="site-main"><section class="use"><div class="container"><div id="content"><h2 id="motivation">Motivation</h2>

<p>TSec began as a desire to improve on what the JCA provides. While the JCA provides well tested,
secure algorithms, it suffers from being incredibly cumbersome to use. As an example, let’s encrypt
something using AES-GCM:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">javax.crypto.</span><span class="o">{</span><span class="nc">Cipher</span><span class="o">,</span> <span class="nc">KeyGenerator</span><span class="o">,</span> <span class="nc">SecretKey</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">javax.crypto.</span><span class="o">{</span><span class="nc">Cipher</span><span class="o">,</span> <span class="nc">KeyGenerator</span><span class="o">,</span> <span class="nc">SecretKey</span><span class="o">}</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">keyGenerator</span><span class="k">:</span> <span class="kt">KeyGenerator</span> <span class="o">=</span> <span class="nc">KeyGenerator</span><span class="o">.</span><span class="n">getInstance</span><span class="o">(</span><span class="s">"AES"</span><span class="o">)</span> <span class="c1">//Stringly typed
</span><span class="n">keyGenerator</span><span class="k">:</span> <span class="kt">javax.crypto.KeyGenerator</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="n">crypto</span><span class="o">.</span><span class="nc">KeyGenerator</span><span class="k">@</span><span class="mi">4</span><span class="n">bf03fee</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">keyGenerator</span><span class="o">.</span><span class="n">init</span><span class="o">(</span><span class="mi">192</span><span class="o">)</span> <span class="c1">//Any way to get this standard constant without setting it yourself? Also mutates!
</span>
<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">secretKey</span><span class="k">:</span> <span class="kt">SecretKey</span> <span class="o">=</span> <span class="n">keyGenerator</span><span class="o">.</span><span class="n">generateKey</span><span class="o">()</span> <span class="c1">//We have no information about what type of key this was
</span><span class="n">secretKey</span><span class="k">:</span> <span class="kt">javax.crypto.SecretKey</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="n">crypto</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="nc">SecretKeySpec</span><span class="nd">@fffe8216</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">cipher</span><span class="k">:</span> <span class="kt">Cipher</span> <span class="o">=</span> <span class="nc">Cipher</span><span class="o">.</span><span class="n">getInstance</span><span class="o">(</span><span class="s">"AES/GCM/NoPadding"</span><span class="o">)</span> <span class="c1">//Stringly Typed. also unsafe. May throw an exception.
</span><span class="n">cipher</span><span class="k">:</span> <span class="kt">javax.crypto.Cipher</span> <span class="o">=</span> <span class="n">javax</span><span class="o">.</span><span class="n">crypto</span><span class="o">.</span><span class="nc">Cipher</span><span class="k">@</span><span class="mf">671d</span><span class="n">a0f9</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">cipher</span><span class="o">.</span><span class="n">init</span><span class="o">(</span><span class="nc">Cipher</span><span class="o">.</span><span class="nc">ENCRYPT_MODE</span><span class="o">,</span> <span class="n">secretKey</span><span class="o">)</span> <span class="c1">//Encrypt mode is an int. May throw an exception. Also mutates!
</span>
<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">toEncrypt</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span> <span class="k">=</span> <span class="s">"Hello"</span><span class="o">.</span><span class="n">getBytes</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">)</span> 
<span class="n">toEncrypt</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">72</span><span class="o">,</span> <span class="mi">101</span><span class="o">,</span> <span class="mi">108</span><span class="o">,</span> <span class="mi">108</span><span class="o">,</span> <span class="mi">111</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">encrypted</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span> <span class="k">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">doFinal</span><span class="o">(</span><span class="n">toEncrypt</span><span class="o">)</span> <span class="c1">//We have no information about 
</span><span class="n">encrypted</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(-</span><span class="mi">51</span><span class="o">,</span> <span class="o">-</span><span class="mi">85</span><span class="o">,</span> <span class="o">-</span><span class="mi">61</span><span class="o">,</span> <span class="o">-</span><span class="mi">123</span><span class="o">,</span> <span class="o">-</span><span class="mi">121</span><span class="o">,</span> <span class="o">-</span><span class="mi">100</span><span class="o">,</span> <span class="mi">118</span><span class="o">,</span> <span class="o">-</span><span class="mi">83</span><span class="o">,</span> <span class="o">-</span><span class="mi">71</span><span class="o">,</span> <span class="o">-</span><span class="mi">79</span><span class="o">,</span> <span class="mi">83</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">39</span><span class="o">,</span> <span class="o">-</span><span class="mi">30</span><span class="o">,</span> <span class="o">-</span><span class="mi">84</span><span class="o">,</span> <span class="o">-</span><span class="mi">120</span><span class="o">,</span> <span class="o">-</span><span class="mi">77</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span> <span class="o">-</span><span class="mi">22</span><span class="o">,</span> <span class="o">-</span><span class="mi">118</span><span class="o">,</span> <span class="mi">61</span><span class="o">)</span>
</code></pre>
</div>

<p>Can you catch the mistake here? It’s easy to overlook, but we do not have a reference to the IV (Initialization Vector) used,
thus we have no way to ever decrypt this if we forgot to retrieve it!</p>

<p>On top of this, outside of these local strings, we have no information carried by the objects about the encryption used,
key type used, and whatnot, which could all be useful at compile time. Feed it a wrong length key, this throws an exception!</p>

<p>TSec was made to improve on this. We provide types where the JCA does not, as well as we provide helpers to propagate 
all the encryption type information the JCA does not, so you can rip out a few hairs at compile time, not when you have to hotfix 
in production.</p>

<p>The same thing, in TSec, plus decryption (as a pure expression):</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">cats.effect.IO</span>
<span class="k">import</span> <span class="nn">cats.effect.IO</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">tsec.common._</span>
<span class="k">import</span> <span class="nn">tsec.common._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">tsec.cipher.symmetric._</span>
<span class="k">import</span> <span class="nn">tsec.cipher.symmetric._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">tsec.cipher.symmetric.jca._</span>
<span class="k">import</span> <span class="nn">tsec.cipher.symmetric.jca._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">toEncrypt</span> <span class="k">=</span> <span class="s">"Hello"</span><span class="o">.</span><span class="n">utf8Bytes</span>
<span class="n">toEncrypt</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">72</span><span class="o">,</span> <span class="mi">101</span><span class="o">,</span> <span class="mi">108</span><span class="o">,</span> <span class="mi">108</span><span class="o">,</span> <span class="mi">111</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="cm">/** An authenticated encryption and decryption */</span>
     <span class="o">|</span> <span class="k">implicit</span> <span class="k">val</span> <span class="n">gcmstrategy</span> <span class="k">=</span> <span class="nc">AES128GCM</span><span class="o">.</span><span class="n">defaultIvStrategy</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
<span class="n">gcmstrategy</span><span class="k">:</span> <span class="kt">tsec.cipher.symmetric.IvGen</span><span class="o">[</span><span class="kt">cats.effect.IO</span>,<span class="kt">tsec.cipher.symmetric.jca.AES128GCM</span><span class="o">]</span> <span class="k">=</span> <span class="n">tsec</span><span class="o">.</span><span class="n">cipher</span><span class="o">.</span><span class="n">symmetric</span><span class="o">.</span><span class="n">jca</span><span class="o">.</span><span class="n">package$GCM$$anon$4</span><span class="k">@</span><span class="mi">15844237</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">encryptAAD</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
     <span class="o">|</span>   <span class="k">for</span> <span class="o">{</span>
     <span class="o">|</span>     <span class="n">key</span>       <span class="k">&lt;-</span> <span class="nc">AES128GCM</span><span class="o">.</span><span class="n">generateKey</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>  <span class="c1">//Generate our key
</span>     <span class="o">|</span>     <span class="n">encrypted</span> <span class="k">&lt;-</span> <span class="nc">AES128GCM</span><span class="o">.</span><span class="n">encrypt</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="nc">PlainText</span><span class="o">(</span><span class="n">toEncrypt</span><span class="o">),</span> <span class="n">key</span><span class="o">)</span> <span class="c1">//Encrypt
</span>     <span class="o">|</span>     <span class="n">decrypted</span> <span class="k">&lt;-</span> <span class="nc">AES128GCM</span><span class="o">.</span><span class="n">decrypt</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="n">encrypted</span><span class="o">,</span> <span class="n">key</span><span class="o">)</span>            <span class="c1">//Decrypt
</span>     <span class="o">|</span>   <span class="o">}</span> <span class="k">yield</span> <span class="n">decrypted</span><span class="o">.</span><span class="n">toUtf8String</span> <span class="c1">// "Hello!" 
</span><span class="n">encryptAAD</span><span class="k">:</span> <span class="kt">cats.effect.IO</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO$493428047</span>
</code></pre>
</div>
</div></div></section><section class="technologies"><div class="container"><div class="row"></div></div></section></main><footer id="site-footer"><div class="container"><div class="row"><div class="col-xs-6"><p>TSec is designed and developed by <a href="" target="_blank">Jose Cardona</a></p></div><div class="col-xs-6"><p class="text-right"><a href="https://github.com/jmcardon/tsec"><span class="fa fa-github"></span>View on GitHub</a></p></div></div><div class="row"><div class="col-xs-6"><p>Website built with <a href="https://47deg.github.io/sbt-microsites/" target="_blank">Sbt-microsites</a> - © 2016 <a href="https://www.47deg.com/" target="_blank">47 Degrees</a></p></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/tsec/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script></body></html>